---
// src/components/recipes/RecipesSidebar.astro
import { getLocale } from '../../i18n/i18n';

interface Recipe {
  id: string;
  title: string;
  image?: string;
  preparation_time: number;
  difficulty?: string;
  category?: string;
}

interface Props {
  recipes: Recipe[];
  title?: string;
}

const { recipes, title } = Astro.props;
const currentLang = getLocale();

const defaultTitle = currentLang === 'es' ? 'Más recetas para ti' : 'More recipes for you';
const displayTitle = title || defaultTitle;

// Traducir categorías
const categoryTranslations: Record<string, string> = {
  'breakfast': currentLang === 'es' ? 'Desayuno' : 'Breakfast',
  'brunch': 'Brunch',
  'lunch': currentLang === 'es' ? 'Almuerzo' : 'Lunch',
  'dinner': currentLang === 'es' ? 'Cena' : 'Dinner',
  'snack': currentLang === 'es' ? 'Snack' : 'Snack'
};

function getCategoryDisplay(category: string | undefined): string {
  if (!category) return 'Receta';
  return categoryTranslations[category.toLowerCase()] || category;
}

function formatTime(minutes: number): string {
  return currentLang === 'es' ? `${minutes} min` : `${minutes} min`;
}

// Traducir dificultad
const difficultyTranslations: Record<string, string> = {
  'easy': currentLang === 'es' ? 'Fácil' : 'Easy',
  'medium': currentLang === 'es' ? 'Media' : 'Medium',
  'hard': currentLang === 'es' ? 'Difícil' : 'Hard',
  'fácil': 'Fácil',
  'media': currentLang === 'es' ? 'Media' : 'Medium',
  'difícil': currentLang === 'es' ? 'Difícil' : 'Hard'
};

function getDifficultyDisplay(difficulty: string | undefined): string {
  if (!difficulty) return currentLang === 'es' ? 'Fácil' : 'Easy';
  return difficultyTranslations[difficulty.toLowerCase()] || difficulty;
}
---

<div class="bg-white border-4 border-[#F8650933] rounded-3xl p-6 sticky top-8">
  <!-- Title -->
  <h3 class="text-2xl font-bold text-black mb-6 pb-3 border-b-2 border-dashed border-gray-300">
    {displayTitle}
  </h3>

  <!-- Recipes List -->
  <div class="space-y-6">
    {recipes.map((recipe) => (
      <a 
        href={`/${currentLang}/${currentLang === 'es' ? 'recetas' : 'recipes'}/${recipe.id}`}
        class="block group"
      >
        <div class="border-2 border-dashed border-gray-300 rounded-2xl overflow-hidden hover:border-[#F86509] transition-colors">
          <!-- Image with Badge -->
          <div class="relative h-40 overflow-hidden">
            <img 
              src={recipe.image || '/images/recipes/placeholder.jpg'} 
              alt={recipe.title}
              class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
            />
            <!-- Category Badge -->
            <div class="absolute top-3 left-3 bg-[#F86509] text-white px-4 py-1 rounded-full text-xs font-bold shadow-md">
              {getCategoryDisplay(recipe.category)}
            </div>
          </div>

          <!-- Content -->
          <div class="p-4 bg-white">
            <h4 class="font-bold text-black text-lg mb-3 line-clamp-2 group-hover:text-[#F86509] transition-colors">
              {recipe.title}
            </h4>

            <!-- Meta Info -->
            <div class="flex items-center gap-4 text-sm">
              <!-- Time -->
              <div class="flex items-center gap-1 text-gray-600">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span>{formatTime(recipe.preparation_time)}</span>
              </div>

              <!-- Difficulty -->
              <div class="text-[#F86509] font-semibold">
                {getDifficultyDisplay(recipe.difficulty)}
              </div>
            </div>
          </div>
        </div>
      </a>
    ))}
  </div>
</div>

<style>
  .line-clamp-2 {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>