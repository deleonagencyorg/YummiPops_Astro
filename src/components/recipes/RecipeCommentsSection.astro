---
// src/components/recipes/RecipeCommentsSection.astro
import { getLocale } from '../../i18n/i18n';

interface Comment {
  id: string;
  author: string;
  date: string;
  content: string;
  avatar?: string;
}

interface Props {
  recipeId: string;
  comments?: Comment[];
}

const { recipeId, comments = [] } = Astro.props;
const currentLang = getLocale();

const translations = {
  title: currentLang === 'es' ? '¿Ya probaste esta receta?' : 'Have you tried this recipe?',
  subtitle: currentLang === 'es' 
    ? 'Cuéntanos cómo te fue y comparte tus tips con la comunidad Ranchitas' 
    : 'Tell us how it went and share your tips with the Ranchitas community',
  namePlaceholder: currentLang === 'es' ? 'Tu nombre (opcional)' : 'Your name (optional)',
  emailPlaceholder: currentLang === 'es' ? 'Tu email (opcional)' : 'Your email (optional)',
  commentPlaceholder: currentLang === 'es' 
    ? 'Cuéntanos tu experiencia con esta receta... (obligatorio)' 
    : 'Tell us about your experience with this recipe... (required)',
  submitButton: currentLang === 'es' ? 'Enviar Comentario' : 'Submit Comment',
  commentsTitle: currentLang === 'es' 
    ? `Comentarios de la comunidad (${comments.length})` 
    : `Community comments (${comments.length})`
};

// Generate initials from name
function getInitials(name: string): string {
  return name
    .split(' ')
    .map(word => word[0])
    .join('')
    .toUpperCase()
    .slice(0, 2);
}

// Generate random color for avatar
function getAvatarColor(name: string): string {
  const colors = [
    'bg-[#F04F00]',
    'bg-[#F86509]', 
    'bg-[#FF6B35]',
    'bg-[#FF8C42]'
  ];
  const index = name.length % colors.length;
  return colors[index];
}
---

<div class="p-8 md:pl-10 md:pr-10 md:pt-0 md:pb-10">
  <!-- Form Section -->
  <div class="mb-12 rounded-[40px] border-2 border-[#F8650933] p-8">
    <h2 class="text-3xl md:text-4xl font-bold text-black mb-3">
      {translations.title}
    </h2>
    <p class="text-gray-600 text-base mb-8">
      {translations.subtitle}
    </p>

    <form id="commentForm" class="space-y-6 ">
      <!-- Name and Email Row -->
      <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input
          type="text"
          name="name"
          placeholder={translations.namePlaceholder}
          class="w-full px-6 py-4 rounded-2xl border-2 border-[#F86509] border-opacity-30 focus:border-[#F86509] focus:outline-none transition-colors"
        />
        <input
          type="email"
          name="email"
          placeholder={translations.emailPlaceholder}
          class="w-full px-6 py-4 rounded-2xl border-2 border-[#F86509] border-opacity-30 focus:border-[#F86509] focus:outline-none transition-colors"
        />
      </div>

      <!-- Comment Textarea -->
      <textarea
        name="comment"
        required
        placeholder={translations.commentPlaceholder}
        rows="6"
        class="w-full px-6 py-4 rounded-2xl border-2 border-[#F86509] border-opacity-30 focus:border-[#F86509] focus:outline-none transition-colors resize-none"
      ></textarea>

      <!-- Submit Button -->
      <button
        type="submit"
        class="bg-[#F86509] text-white font-bold px-10 py-4 rounded-full hover:bg-[#d54500] transition-all transform hover:-translate-y-1 hover:shadow-lg"
      >
        {translations.submitButton}
      </button>
    </form>
  </div>

  <!-- Comments Section -->
  {comments.length > 0 && (
    <div>
      <h3 class="text-2xl font-bold text-black mb-6">
        {translations.commentsTitle}
      </h3>

      <div class="space-y-4">
        {comments.map((comment) => (
          <div class="bg-[#F5EDD8] rounded-2xl p-6">
            <div class="flex items-start gap-4">
              <!-- Avatar -->
              <div class={`w-12 h-12 rounded-full ${getAvatarColor(comment.author)} flex items-center justify-center flex-shrink-0`}>
                <span class="text-white font-bold text-lg">
                  {getInitials(comment.author)}
                </span>
              </div>

              <!-- Comment Content -->
              <div class="flex-1">
                <div class="flex items-center gap-3 mb-2">
                  <h4 class="font-bold text-black">{comment.author}</h4>
                  <span class="text-gray-500 text-sm">{comment.date}</span>
                </div>
                <p class="text-gray-700 text-base leading-relaxed">
                  {comment.content}
                </p>
              </div>
            </div>
          </div>
        ))}
      </div>
    </div>
  )}
</div>

<script>
  const form = document.getElementById('commentForm') as HTMLFormElement;
  
  form?.addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const formData = new FormData(form);
    const comment = formData.get('comment');
    
    if (!comment || comment.toString().trim() === '') {
      alert('Por favor escribe un comentario');
      return;
    }
    
    console.log('Comment submitted:', {
      name: formData.get('name'),
      email: formData.get('email'),
      comment: formData.get('comment')
    });
    
    alert('¡Gracias por tu comentario!');
    form.reset();
  });
</script>