---
import LanguageSwitcher from '../../i18n/LanguageSwitcher.astro';
import { t, type Locale } from '../../../i18n/i18n';
import { logos } from '../../../config/assets';
import type { HeaderColorConfig } from '../../../config/headerColors';
import SocialMediaIcons from '../SocialMediaIcons/index.astro';
import productsEs from '../../../locales/es/products.json';
import productsEn from '../../../locales/en/products.json';

export interface Props {
  currentLang: Locale;
  headerColorConfig: HeaderColorConfig;
}

const { currentLang, headerColorConfig } = Astro.props;

// Get current path to determine active menu item
const { pathname } = Astro.url;
const currentPath = pathname;

// Obtener los datos de social media y menú desde las traducciones
const menuItems = t('menu_items', { namespace: 'common', locale: currentLang }) as any[];

const productsData = currentLang === 'es' ? productsEs : productsEn;
const productsItems = (productsData as any)?.items ?? [];
const productsBasePath = `/${currentLang}/${currentLang === 'es' ? 'productos' : 'products'}`;
const productsMenuTitle = currentLang === 'es' ? 'Nuestros Productos' : 'Our Products';
---

<!-- Desktop Navigation -->
<nav 
  class="hidden md:flex items-center justify-between w-full py-[28px] px-6 bg-white rounded-[25px] mt-6 mx-auto max-w-[1400px]"
  data-current-lang={currentLang}
>
  <!-- Logo -->
  <div class="flex-shrink-0">
    <a href={`/${currentLang}/`} class="block">
      <img 
        src="/images/es/logo.png" 
        alt="Logo" 
        class="h-[62px] w-[91px]"
      />
    </a>
  </div>

  <!-- Menu -->
  <div class="flex space-x-10 relative" id="desktop-menu-items">
    {menuItems && menuItems.map((item: any) => (
      item?.id === 'products' ? (
        <div class="group">
          <a
            href={item.href}
            class="text-black font-title text-lg tracking-wide hover:opacity-80 transition inline-flex items-center"
          >
            {item.text}
          </a>
        </div>
      ) : (
        <a
          href={item.href}
          class="text-black font-title text-lg tracking-wide 
                 hover:opacity-80 transition"
        >
          {item.text}
        </a>
      )
    ))}
  </div>
  <!-- Right section: Button + User -->
  <div class="flex items-center space-x-4">
    <LanguageSwitcher activeLocale={currentLang} headerColorConfig={headerColorConfig} textColorValue='black'/>
    <a 
      href={currentLang === 'es' ? 'es/contacto' : 'en/contact'}
      class="bg-black text-white px-[50px] py-3 rounded-full font-semibold 
             shadow-md hover:opacity-90 transition"
    >
      <span class="text-[20px]">{currentLang === 'es' ? 'Contáctanos' : 'Contact Us'}</span>
    </a>
  </div>
</nav>

<script is:inline>
  (function () {
    function initProductsSubmenu() {
      const root = document.getElementById('desktop-menu-items');
      if (!root) return;

      const scroll = root.querySelector('.products-submenu-scroll');
      const prev = root.querySelector('.products-submenu-prev');
      const next = root.querySelector('.products-submenu-next');
      if (!(scroll instanceof HTMLElement)) return;

      const scrollByAmount = () => Math.max(260 + 24, Math.floor(scroll.clientWidth * 0.8));

      if (prev) {
        prev.addEventListener('click', (e) => {
          e.preventDefault();
          scroll.scrollBy({ left: -scrollByAmount(), behavior: 'smooth' });
        });
      }

      if (next) {
        next.addEventListener('click', (e) => {
          e.preventDefault();
          scroll.scrollBy({ left: scrollByAmount(), behavior: 'smooth' });
        });
      }
    }

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initProductsSubmenu);
    } else {
      initProductsSubmenu();
    }

    document.addEventListener('astro:page-load', initProductsSubmenu);
  })();
</script>

