---
import { t, type Locale } from '../../../i18n/i18n';
import Breadcrumb from '../../../components/common/Breadcrumb/Breadcrumb.astro';
import BlogDetailSkeleton from '../../../components/blog/BlogDetailSkeleton.astro';
import { fade, slide } from 'astro:transitions';
import LazyImage from '../../../components/common/LazyImage.astro';
import { ViewTransitions } from 'astro:transitions';
import CardQuiz from '../../../components/common/cardQuiz/index.astro';
import './styles.css';

interface Props {
  blogPost: {
    id: string;
    slug: string;
    title: string;
    content: string;
    image: string;
    author: string;
    published_date: string;
    category?: string;
    reading_time?: string;
    summary?: string;
    gallery_images?: string[];
  };
  currentLang: Locale;
  allBlogPosts?: Array<{
    id: string;
    slug: string;
    title: string;
    summary: string;
    image: string;
    published_date: string;
  }>;
  isLoading?: boolean;
}

const { blogPost, currentLang, allBlogPosts = [], isLoading = false } = Astro.props;
const cardQuizAssets = t('cardQuiz', { namespace: 'common', locale: currentLang }) || {};
const suggestedPosts = allBlogPosts
  .filter(post => post.id !== blogPost.id)
  .slice(0, 3);

// Translations
const readMoreTitle = currentLang === 'es' ? 'También te puede interesar' : 'You may also be interested';
const shareText = currentLang === 'es' ? 'Compartir:' : 'Share:';
const readingTimeText = currentLang === 'es' ? 'min de lectura' : 'min read';
const backToNewsText = currentLang === 'es' ? 'Volver a noticias' : 'Back to news';
const backToNewsHref = `/${currentLang}/blog`;

const categoryDisplay = blogPost.category || (currentLang === 'es' ? 'Promociones' : 'Promotions');
const readingTime = blogPost.reading_time || '5';

function highlightTitle(title: string) {
  const wordsToHighlight = ['Pops Nacho', 'Yummi Pops', 'Ranchitas'];
  let result = title;
  wordsToHighlight.forEach(word => {
    if (title.includes(word)) {
      result = result.replace(word, `<span class="text-[#FFD700] underline decoration-[#FFD700] decoration-4 underline-offset-4">${word}</span>`);
    }
  });
  return result;
}

// Gallery images placeholder
const galleryImages = blogPost.gallery_images || [
  '/images/blog/gallery-1.jpg',
  '/images/blog/gallery-2.jpg',
  '/images/blog/gallery-3.jpg'
];
---
<div class="bg-white">
  <ViewTransitions />
  <div class="container mx-auto">
    <div class="px-4 md:px-8 lg:px-10 pt-6 pb-20">
      {isLoading ? (
        <BlogDetailSkeleton />
      ) : (
        <>
          <Breadcrumb bgColor="bg-transparent" textColor="text-black" hoverColor="hover:text-black" />

          <!-- Hero Section: 2 columns -->
          <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12 items-start">
            
            <!-- Left: Content -->
            <div>
              <!-- Category Badge -->
              <div class="mb-4">
                <span class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[#1a1a1a] text-white font-bold text-sm">
                  <span class="w-2 h-2 bg-[#FFD700] rounded-full"></span>
                  {categoryDisplay}
                </span>
              </div>

              <!-- Title -->
              <h1 
                class="text-4xl md:text-5xl lg:text-[56px] font-black text-black leading-[1.1] mb-6"
                transition:name={`blog-title-${blogPost.id}`}
                set:html={highlightTitle(blogPost.title)}
              />

              <!-- Meta Info -->
              <div class="flex items-center gap-3 text-gray-400 text-sm mb-5">
                <span class="flex items-center gap-1">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="10"/>
                    <path d="M12 6v6l4 2"/>
                  </svg>
                  {readingTime} {readingTimeText}
                </span>
                <span>{blogPost.published_date}</span>
              </div>

              <!-- Share Icons -->
              <div class="flex items-center gap-3 mb-8">
                <span class="text-sm text-gray-500">{shareText}</span>
                <div class="flex gap-2">
                  <a href={`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(Astro.url.href)}`} target="_blank" rel="noopener noreferrer" class="w-9 h-9 rounded-full bg-white border border-gray-200 text-black flex items-center justify-center hover:bg-gray-100 transition">
                    <svg width="9" height="15" viewBox="0 0 9 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M7.99984 0.666687H5.99984C5.11578 0.666687 4.26794 1.01788 3.64281 1.643C3.01769 2.26812 2.6665 3.11597 2.6665 4.00002V6.00002H0.666504V8.66669H2.6665V14H5.33317V8.66669H7.33317L7.99984 6.00002H5.33317V4.00002C5.33317 3.82321 5.40341 3.65364 5.52843 3.52862C5.65346 3.40359 5.82303 3.33335 5.99984 3.33335H7.99984V0.666687Z" stroke="#0A0A0A" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </a>
                  <a href={`https://twitter.com/intent/tweet?url=${encodeURIComponent(Astro.url.href)}&text=${encodeURIComponent(blogPost.title)}`} target="_blank" rel="noopener noreferrer" class="w-9 h-9 rounded-full bg-white border border-gray-200 text-black flex items-center justify-center hover:bg-gray-100 transition">
                    <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M0.665039 12.665L5.69731 7.63271M5.69731 7.63271L0.665039 0.664978H3.99837L7.63277 5.69724M5.69731 7.63271L9.33171 12.665H12.665L7.63277 5.69724M12.665 0.664978L7.63277 5.69724" stroke="#0A0A0A" stroke-width="1.33" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </a>
                  <button type="button" class="w-9 h-9 rounded-full bg-white border border-gray-200 text-black flex items-center justify-center hover:bg-gray-100 transition" onclick="navigator.share ? navigator.share({title: document.title, url: window.location.href}) : null">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 5.33331C13.1046 5.33331 14 4.43788 14 3.33331C14 2.22874 13.1046 1.33331 12 1.33331C10.8954 1.33331 10 2.22874 10 3.33331C10 4.43788 10.8954 5.33331 12 5.33331Z" stroke="#0A0A0A" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M4 10C5.10457 10 6 9.10457 6 8C6 6.89543 5.10457 6 4 6C2.89543 6 2 6.89543 2 8C2 9.10457 2.89543 10 4 10Z" stroke="#0A0A0A" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M12 14.6667C13.1046 14.6667 14 13.7713 14 12.6667C14 11.5621 13.1046 10.6667 12 10.6667C10.8954 10.6667 10 11.5621 10 12.6667C10 13.7713 10.8954 14.6667 12 14.6667Z" stroke="#0A0A0A" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M5.72656 9.00665L10.2799 11.66" stroke="#0A0A0A" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M10.2732 4.34003L5.72656 6.99336" stroke="#0A0A0A" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                  <button type="button" class="w-9 h-9 rounded-full bg-white border border-gray-200 text-black flex items-center justify-center hover:bg-gray-100 transition" onclick={`navigator.clipboard.writeText('${Astro.url.href}'); alert('${currentLang === 'es' ? 'Enlace copiado' : 'Link copied'}');`}>
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M6.00016 11.3334H4.66683C3.78277 11.3334 2.93493 10.9822 2.30981 10.357C1.68469 9.73192 1.3335 8.88408 1.3335 8.00002C1.3335 7.11597 1.68469 6.26812 2.30981 5.643C2.93493 5.01788 3.78277 4.66669 4.66683 4.66669H6.00016" stroke="#0A0A0A" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M10 4.66669H11.3333C12.2174 4.66669 13.0652 5.01788 13.6904 5.643C14.3155 6.26812 14.6667 7.11597 14.6667 8.00002C14.6667 8.88408 14.3155 9.73192 13.6904 10.357C13.0652 10.9822 12.2174 11.3334 11.3333 11.3334H10" stroke="#0A0A0A" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M5.3335 8H10.6668" stroke="#0A0A0A" stroke-width="1.33333" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  </button>
                </div>
              </div>

              <!-- Summary -->
              {blogPost.summary && (
                <p class="text-black font-semibold leading-relaxed text-base">
                  {blogPost.summary}
                </p>
              )}
            </div>

            <!-- Right: Featured Image -->
            <div>
              <div class="relative rounded-[24px] overflow-hidden" transition:animate={slide({ duration: '0.3s' })}>
                <LazyImage
                  src={blogPost.image}
                  alt={blogPost.title}
                  class="w-full h-[300px] md:h-[380px] lg:h-[420px] object-cover"
                  loading="eager"
                />
              </div>
            </div>
          </div>

          <!-- ============================================ -->
          <!-- Content Section - Cream Card -->
          <!-- ============================================ -->
          <div class="mt-10">
            <div class="bg-white rounded-[32px] p-6 md:p-10 lg:p-12">
              
              <div class="blog-content max-w-none text-black" transition:animate={fade({ duration: '0.5s' })}>
                
                <!-- Párrafo 1 -->
                <p class="font-semibold text-base md:text-lg leading-relaxed mb-8">
                  To participate in the dynamic, all you had to do was buy your favorite presentation of Yummi Pops Nacho in selected convenience stores. Then, enter the registration form hosted at www.snacksyummies.com, send your complete data and purchase invoice as proof of purchase.
                </p>

                <!-- Galería de 3 imágenes -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 my-10 items-center">
                  <!-- Image 1 - Curva izquierda -->
                  <div class="flex justify-center">
                    <img 
                      src={galleryImages[0]} 
                      alt="Gallery image 1"
                      class="w-full h-[200px] md:h-[250px] object-cover rounded-l-[100px] rounded-r-[20px]"
                    />
                  </div>
                  <!-- Image 2 - Centro, más alta -->
                  <div class="flex justify-center">
                    <img 
                      src={galleryImages[1]} 
                      alt="Gallery image 2"
                      class="w-full h-[220px] md:h-[300px] object-cover rounded-[20px]"
                    />
                  </div>
                  <!-- Image 3 - Curva derecha -->
                  <div class="flex justify-center">
                    <img 
                      src={galleryImages[2]} 
                      alt="Gallery image 3"
                      class="w-full h-[200px] md:h-[250px] object-cover rounded-l-[20px] rounded-r-[100px]"
                    />
                  </div>
                </div>

                <!-- Párrafo 2 -->
                <p class="font-semibold text-base md:text-lg leading-relaxed mb-8">
                  Dozens of Catrachos filled their lives with POP! With the only Yummies Snacks that are NEVER FRIED, gluten free and with 0% Trans Fats.
                </p>

                <!-- Blockquote -->
                <div class="blog-quote border-l-4 border-[#F59E0B] bg-[#FEF9E7] rounded-r-[20px] p-6 my-8">
                  <p class="text-gray-500 text-sm mb-2">— Juan Miguel Izaguirre Pavón, Ganador 2022</p>
                  <p class="font-bold text-black text-base md:text-lg leading-relaxed">
                    "I received my prize and I invite you to consume Honduran products from responsible companies like this one in their promotions"
                  </p>
                </div>

                <!-- Párrafo 3 -->
                <p class="font-semibold text-base md:text-lg leading-relaxed">
                  Choose also your favorite, among the presentations: Jalapeño Cream or Queso Blanco and fill your days with POP.
                </p>

              </div>
            </div>
          </div>

        </>
      )}
    </div>
  </div>
</div>


     <section class="w-full relative !bg-white pt-[100px]">
      <div class="relative z-30">
        <CardQuiz 
          newsletter={cardQuizAssets}
        />
      </div>
    </section>

<style>
  .blog-content p {
    line-height: 1.8;
  }

  @media (max-width: 768px) {
    .blog-content img {
      border-radius: 20px !important;
    }
  }
</style>